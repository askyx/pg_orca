set pg_orca.enable_orca to off;
create database tpch;
\c tpch
create extension pg_tpch;
set pg_orca.enable_orca to off;
select query as query1 from tpch_queries(1); \gset
                                  query1                                  
--------------------------------------------------------------------------
 SELECT                                                                  +
     l_returnflag,                                                       +
     l_linestatus,                                                       +
     sum(l_quantity) AS sum_qty,                                         +
     sum(l_extendedprice) AS sum_base_price,                             +
     sum(l_extendedprice * (1 - l_discount)) AS sum_disc_price,          +
     sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) AS sum_charge,+
     avg(l_quantity) AS avg_qty,                                         +
     avg(l_extendedprice) AS avg_price,                                  +
     avg(l_discount) AS avg_disc,                                        +
     count(*) AS count_order                                             +
 FROM                                                                    +
     lineitem                                                            +
 WHERE                                                                   +
     l_shipdate <= CAST('1998-09-02' AS date)                            +
 GROUP BY                                                                +
     l_returnflag,                                                       +
     l_linestatus                                                        +
 ORDER BY                                                                +
     l_returnflag,                                                       +
     l_linestatus;                                                       +
 
(1 row)

select query as query2 from tpch_queries(2); \gset
                  query2                   
-------------------------------------------
 SELECT                                   +
     s_acctbal,                           +
     s_name,                              +
     n_name,                              +
     p_partkey,                           +
     p_mfgr,                              +
     s_address,                           +
     s_phone,                             +
     s_comment                            +
 FROM                                     +
     part,                                +
     supplier,                            +
     partsupp,                            +
     nation,                              +
     region                               +
 WHERE                                    +
     p_partkey = ps_partkey               +
     AND s_suppkey = ps_suppkey           +
     AND p_size = 15                      +
     AND p_type LIKE '%BRASS'             +
     AND s_nationkey = n_nationkey        +
     AND n_regionkey = r_regionkey        +
     AND r_name = 'EUROPE'                +
     AND ps_supplycost = (                +
         SELECT                           +
             min(ps_supplycost)           +
         FROM                             +
             partsupp,                    +
             supplier,                    +
             nation,                      +
             region                       +
         WHERE                            +
             p_partkey = ps_partkey       +
             AND s_suppkey = ps_suppkey   +
             AND s_nationkey = n_nationkey+
             AND n_regionkey = r_regionkey+
             AND r_name = 'EUROPE')       +
 ORDER BY                                 +
     s_acctbal DESC,                      +
     n_name,                              +
     s_name,                              +
     p_partkey                            +
 LIMIT 100;                               +
 
(1 row)

select query as query3 from tpch_queries(3); \gset
                         query3                          
---------------------------------------------------------
 SELECT                                                 +
     l_orderkey,                                        +
     sum(l_extendedprice * (1 - l_discount)) AS revenue,+
     o_orderdate,                                       +
     o_shippriority                                     +
 FROM                                                   +
     customer,                                          +
     orders,                                            +
     lineitem                                           +
 WHERE                                                  +
     c_mktsegment = 'BUILDING'                          +
     AND c_custkey = o_custkey                          +
     AND l_orderkey = o_orderkey                        +
     AND o_orderdate < CAST('1995-03-15' AS date)       +
     AND l_shipdate > CAST('1995-03-15' AS date)        +
 GROUP BY                                               +
     l_orderkey,                                        +
     o_orderdate,                                       +
     o_shippriority                                     +
 ORDER BY                                               +
     revenue DESC,                                      +
     o_orderdate                                        +
 LIMIT 10;                                              +
 
(1 row)

select query as query4 from tpch_queries(4); \gset
                      query4                      
--------------------------------------------------
 SELECT                                          +
     o_orderpriority,                            +
     count(*) AS order_count                     +
 FROM                                            +
     orders                                      +
 WHERE                                           +
     o_orderdate >= CAST('1993-07-01' AS date)   +
     AND o_orderdate < CAST('1993-10-01' AS date)+
     AND EXISTS (                                +
         SELECT                                  +
             *                                   +
         FROM                                    +
             lineitem                            +
         WHERE                                   +
             l_orderkey = o_orderkey             +
             AND l_commitdate < l_receiptdate)   +
 GROUP BY                                        +
     o_orderpriority                             +
 ORDER BY                                        +
     o_orderpriority;                            +
 
(1 row)

select query as query5 from tpch_queries(5); \gset
                         query5                         
--------------------------------------------------------
 SELECT                                                +
     n_name,                                           +
     sum(l_extendedprice * (1 - l_discount)) AS revenue+
 FROM                                                  +
     customer,                                         +
     orders,                                           +
     lineitem,                                         +
     supplier,                                         +
     nation,                                           +
     region                                            +
 WHERE                                                 +
     c_custkey = o_custkey                             +
     AND l_orderkey = o_orderkey                       +
     AND l_suppkey = s_suppkey                         +
     AND c_nationkey = s_nationkey                     +
     AND s_nationkey = n_nationkey                     +
     AND n_regionkey = r_regionkey                     +
     AND r_name = 'ASIA'                               +
     AND o_orderdate >= CAST('1994-01-01' AS date)     +
     AND o_orderdate < CAST('1995-01-01' AS date)      +
 GROUP BY                                              +
     n_name                                            +
 ORDER BY                                              +
     revenue DESC;                                     +
 
(1 row)

select query as query6 from tpch_queries(6); \gset
                      query6                      
--------------------------------------------------
 SELECT                                          +
     sum(l_extendedprice * l_discount) AS revenue+
 FROM                                            +
     lineitem                                    +
 WHERE                                           +
     l_shipdate >= CAST('1994-01-01' AS date)    +
     AND l_shipdate < CAST('1995-01-01' AS date) +
     AND l_discount BETWEEN 0.05                 +
     AND 0.07                                    +
     AND l_quantity < 24;                        +
 
(1 row)

select query as query7 from tpch_queries(7); \gset
                          query7                           
-----------------------------------------------------------
 SELECT                                                   +
     supp_nation,                                         +
     cust_nation,                                         +
     l_year,                                              +
     sum(volume) AS revenue                               +
 FROM (                                                   +
     SELECT                                               +
         n1.n_name AS supp_nation,                        +
         n2.n_name AS cust_nation,                        +
         extract(year FROM l_shipdate) AS l_year,         +
         l_extendedprice * (1 - l_discount) AS volume     +
     FROM                                                 +
         supplier,                                        +
         lineitem,                                        +
         orders,                                          +
         customer,                                        +
         nation n1,                                       +
         nation n2                                        +
     WHERE                                                +
         s_suppkey = l_suppkey                            +
         AND o_orderkey = l_orderkey                      +
         AND c_custkey = o_custkey                        +
         AND s_nationkey = n1.n_nationkey                 +
         AND c_nationkey = n2.n_nationkey                 +
         AND ((n1.n_name = 'FRANCE'                       +
                 AND n2.n_name = 'GERMANY')               +
             OR (n1.n_name = 'GERMANY'                    +
                 AND n2.n_name = 'FRANCE'))               +
         AND l_shipdate BETWEEN CAST('1995-01-01' AS date)+
         AND CAST('1996-12-31' AS date)) AS shipping      +
 GROUP BY                                                 +
     supp_nation,                                         +
     cust_nation,                                         +
     l_year                                               +
 ORDER BY                                                 +
     supp_nation,                                         +
     cust_nation,                                         +
     l_year;                                              +
 
(1 row)

select query as query8 from tpch_queries(8); \gset
                            query8                             
---------------------------------------------------------------
 SELECT                                                       +
     o_year,                                                  +
     sum(                                                     +
         CASE WHEN nation = 'BRAZIL' THEN                     +
             volume                                           +
         ELSE                                                 +
             0                                                +
         END) / sum(volume) AS mkt_share                      +
 FROM (                                                       +
     SELECT                                                   +
         extract(year FROM o_orderdate) AS o_year,            +
         l_extendedprice * (1 - l_discount) AS volume,        +
         n2.n_name AS nation                                  +
     FROM                                                     +
         part,                                                +
         supplier,                                            +
         lineitem,                                            +
         orders,                                              +
         customer,                                            +
         nation n1,                                           +
         nation n2,                                           +
         region                                               +
     WHERE                                                    +
         p_partkey = l_partkey                                +
         AND s_suppkey = l_suppkey                            +
         AND l_orderkey = o_orderkey                          +
         AND o_custkey = c_custkey                            +
         AND c_nationkey = n1.n_nationkey                     +
         AND n1.n_regionkey = r_regionkey                     +
         AND r_name = 'AMERICA'                               +
         AND s_nationkey = n2.n_nationkey                     +
         AND o_orderdate BETWEEN CAST('1995-01-01' AS date)   +
         AND CAST('1996-12-31' AS date)                       +
         AND p_type = 'ECONOMY ANODIZED STEEL') AS all_nations+
 GROUP BY                                                     +
     o_year                                                   +
 ORDER BY                                                     +
     o_year;                                                  +
 
(1 row)

select query as query9 from tpch_queries(9); \gset
                                      query9                                       
-----------------------------------------------------------------------------------
 SELECT                                                                           +
     nation,                                                                      +
     o_year,                                                                      +
     sum(amount) AS sum_profit                                                    +
 FROM (                                                                           +
     SELECT                                                                       +
         n_name AS nation,                                                        +
         extract(year FROM o_orderdate) AS o_year,                                +
         l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity AS amount+
     FROM                                                                         +
         part,                                                                    +
         supplier,                                                                +
         lineitem,                                                                +
         partsupp,                                                                +
         orders,                                                                  +
         nation                                                                   +
     WHERE                                                                        +
         s_suppkey = l_suppkey                                                    +
         AND ps_suppkey = l_suppkey                                               +
         AND ps_partkey = l_partkey                                               +
         AND p_partkey = l_partkey                                                +
         AND o_orderkey = l_orderkey                                              +
         AND s_nationkey = n_nationkey                                            +
         AND p_name LIKE '%green%') AS profit                                     +
 GROUP BY                                                                         +
     nation,                                                                      +
     o_year                                                                       +
 ORDER BY                                                                         +
     nation,                                                                      +
     o_year DESC;                                                                 +
 
(1 row)

select query as query10 from tpch_queries(10); \gset
                         query10                         
---------------------------------------------------------
 SELECT                                                 +
     c_custkey,                                         +
     c_name,                                            +
     sum(l_extendedprice * (1 - l_discount)) AS revenue,+
     c_acctbal,                                         +
     n_name,                                            +
     c_address,                                         +
     c_phone,                                           +
     c_comment                                          +
 FROM                                                   +
     customer,                                          +
     orders,                                            +
     lineitem,                                          +
     nation                                             +
 WHERE                                                  +
     c_custkey = o_custkey                              +
     AND l_orderkey = o_orderkey                        +
     AND o_orderdate >= CAST('1993-10-01' AS date)      +
     AND o_orderdate < CAST('1994-01-01' AS date)       +
     AND l_returnflag = 'R'                             +
     AND c_nationkey = n_nationkey                      +
 GROUP BY                                               +
     c_custkey,                                         +
     c_name,                                            +
     c_acctbal,                                         +
     c_phone,                                           +
     n_name,                                            +
     c_address,                                         +
     c_comment                                          +
 ORDER BY                                               +
     revenue DESC                                       +
 LIMIT 20;                                              +
 
(1 row)

select query as query11 from tpch_queries(11); \gset
                           query11                           
-------------------------------------------------------------
 SELECT                                                     +
     ps_partkey,                                            +
     sum(ps_supplycost * ps_availqty) AS value              +
 FROM                                                       +
     partsupp,                                              +
     supplier,                                              +
     nation                                                 +
 WHERE                                                      +
     ps_suppkey = s_suppkey                                 +
     AND s_nationkey = n_nationkey                          +
     AND n_name = 'GERMANY'                                 +
 GROUP BY                                                   +
     ps_partkey                                             +
 HAVING                                                     +
     sum(ps_supplycost * ps_availqty) > (                   +
         SELECT                                             +
             sum(ps_supplycost * ps_availqty) * 0.0001000000+
         FROM                                               +
             partsupp,                                      +
             supplier,                                      +
             nation                                         +
         WHERE                                              +
             ps_suppkey = s_suppkey                         +
             AND s_nationkey = n_nationkey                  +
             AND n_name = 'GERMANY')                        +
 ORDER BY                                                   +
     value DESC;                                            +
 
(1 row)

select query as query12 from tpch_queries(12); \gset
                       query12                       
-----------------------------------------------------
 SELECT                                             +
     l_shipmode,                                    +
     sum(                                           +
         CASE WHEN o_orderpriority = '1-URGENT'     +
             OR o_orderpriority = '2-HIGH' THEN     +
             1                                      +
         ELSE                                       +
             0                                      +
         END) AS high_line_count,                   +
     sum(                                           +
         CASE WHEN o_orderpriority <> '1-URGENT'    +
             AND o_orderpriority <> '2-HIGH' THEN   +
             1                                      +
         ELSE                                       +
             0                                      +
         END) AS low_line_count                     +
 FROM                                               +
     orders,                                        +
     lineitem                                       +
 WHERE                                              +
     o_orderkey = l_orderkey                        +
     AND l_shipmode IN ('MAIL', 'SHIP')             +
     AND l_commitdate < l_receiptdate               +
     AND l_shipdate < l_commitdate                  +
     AND l_receiptdate >= CAST('1994-01-01' AS date)+
     AND l_receiptdate < CAST('1995-01-01' AS date) +
 GROUP BY                                           +
     l_shipmode                                     +
 ORDER BY                                           +
     l_shipmode;                                    +
 
(1 row)

select query as query13 from tpch_queries(13); \gset
                       query13                       
-----------------------------------------------------
 SELECT                                             +
     c_count,                                       +
     count(*) AS custdist                           +
 FROM (                                             +
     SELECT                                         +
         c_custkey,                                 +
         count(o_orderkey)                          +
     FROM                                           +
         customer                                   +
     LEFT OUTER JOIN orders ON c_custkey = o_custkey+
     AND o_comment NOT LIKE '%special%requests%'    +
 GROUP BY                                           +
     c_custkey) AS c_orders (c_custkey,             +
         c_count)                                   +
 GROUP BY                                           +
     c_count                                        +
 ORDER BY                                           +
     custdist DESC,                                 +
     c_count DESC;                                  +
 
(1 row)

select query as query14 from tpch_queries(14); \gset
                                 query14                                 
-------------------------------------------------------------------------
 SELECT                                                                 +
     100.00 * sum(                                                      +
         CASE WHEN p_type LIKE 'PROMO%' THEN                            +
             l_extendedprice * (1 - l_discount)                         +
         ELSE                                                           +
             0                                                          +
         END) / sum(l_extendedprice * (1 - l_discount)) AS promo_revenue+
 FROM                                                                   +
     lineitem,                                                          +
     part                                                               +
 WHERE                                                                  +
     l_partkey = p_partkey                                              +
     AND l_shipdate >= date '1995-09-01'                                +
     AND l_shipdate < CAST('1995-10-01' AS date);                       +
 
(1 row)

select query as query15 from tpch_queries(15); \gset
                                 query15                                  
--------------------------------------------------------------------------
 SELECT                                                                  +
     s_suppkey,                                                          +
     s_name,                                                             +
     s_address,                                                          +
     s_phone,                                                            +
     total_revenue                                                       +
 FROM                                                                    +
     supplier,                                                           +
     (                                                                   +
         SELECT                                                          +
             l_suppkey AS supplier_no,                                   +
             sum(l_extendedprice * (1 - l_discount)) AS total_revenue    +
         FROM                                                            +
             lineitem                                                    +
         WHERE                                                           +
             l_shipdate >= CAST('1996-01-01' AS date)                    +
             AND l_shipdate < CAST('1996-04-01' AS date)                 +
         GROUP BY                                                        +
             supplier_no) revenue0                                       +
 WHERE                                                                   +
     s_suppkey = supplier_no                                             +
     AND total_revenue = (                                               +
         SELECT                                                          +
             max(total_revenue)                                          +
         FROM (                                                          +
             SELECT                                                      +
                 l_suppkey AS supplier_no,                               +
                 sum(l_extendedprice * (1 - l_discount)) AS total_revenue+
             FROM                                                        +
                 lineitem                                                +
             WHERE                                                       +
                 l_shipdate >= CAST('1996-01-01' AS date)                +
                 AND l_shipdate < CAST('1996-04-01' AS date)             +
             GROUP BY                                                    +
                 supplier_no) revenue1)                                  +
 ORDER BY                                                                +
     s_suppkey;                                                          +
 
(1 row)

select query as query16 from tpch_queries(16); \gset
                       query16                       
-----------------------------------------------------
 SELECT                                             +
     p_brand,                                       +
     p_type,                                        +
     p_size,                                        +
     count(DISTINCT ps_suppkey) AS supplier_cnt     +
 FROM                                               +
     partsupp,                                      +
     part                                           +
 WHERE                                              +
     p_partkey = ps_partkey                         +
     AND p_brand <> 'Brand#45'                      +
     AND p_type NOT LIKE 'MEDIUM POLISHED%'         +
     AND p_size IN (49, 14, 23, 45, 19, 3, 36, 9)   +
     AND ps_suppkey NOT IN (                        +
         SELECT                                     +
             s_suppkey                              +
         FROM                                       +
             supplier                               +
         WHERE                                      +
             s_comment LIKE '%Customer%Complaints%')+
 GROUP BY                                           +
     p_brand,                                       +
     p_type,                                        +
     p_size                                         +
 ORDER BY                                           +
     supplier_cnt DESC,                             +
     p_brand,                                       +
     p_type,                                        +
     p_size;                                        +
 
(1 row)

select query as query17 from tpch_queries(17); \gset
                   query17                    
----------------------------------------------
 SELECT                                      +
     sum(l_extendedprice) / 7.0 AS avg_yearly+
 FROM                                        +
     lineitem,                               +
     part                                    +
 WHERE                                       +
     p_partkey = l_partkey                   +
     AND p_brand = 'Brand#23'                +
     AND p_container = 'MED BOX'             +
     AND l_quantity < (                      +
         SELECT                              +
             0.2 * avg(l_quantity)           +
         FROM                                +
             lineitem                        +
         WHERE                               +
             l_partkey = p_partkey);         +
 
(1 row)

select query as query18 from tpch_queries(18); \gset
              query18               
------------------------------------
 SELECT                            +
     c_name,                       +
     c_custkey,                    +
     o_orderkey,                   +
     o_orderdate,                  +
     o_totalprice,                 +
     sum(l_quantity)               +
 FROM                              +
     customer,                     +
     orders,                       +
     lineitem                      +
 WHERE                             +
     o_orderkey IN (               +
         SELECT                    +
             l_orderkey            +
         FROM                      +
             lineitem              +
         GROUP BY                  +
             l_orderkey            +
         HAVING                    +
             sum(l_quantity) > 300)+
     AND c_custkey = o_custkey     +
     AND o_orderkey = l_orderkey   +
 GROUP BY                          +
     c_name,                       +
     c_custkey,                    +
     o_orderkey,                   +
     o_orderdate,                  +
     o_totalprice                  +
 ORDER BY                          +
     o_totalprice DESC,            +
     o_orderdate                   +
 LIMIT 100;                        +
 
(1 row)

select query as query19 from tpch_queries(19); \gset
                                 query19                                  
--------------------------------------------------------------------------
 SELECT                                                                  +
     sum(l_extendedprice * (1 - l_discount)) AS revenue                  +
 FROM                                                                    +
     lineitem,                                                           +
     part                                                                +
 WHERE (p_partkey = l_partkey                                            +
     AND p_brand = 'Brand#12'                                            +
     AND p_container IN ('SM CASE', 'SM BOX', 'SM PACK', 'SM PKG')       +
     AND l_quantity >= 1                                                 +
     AND l_quantity <= 1 + 10                                            +
     AND p_size BETWEEN 1 AND 5                                          +
     AND l_shipmode IN ('AIR', 'AIR REG')                                +
     AND l_shipinstruct = 'DELIVER IN PERSON')                           +
     OR (p_partkey = l_partkey                                           +
         AND p_brand = 'Brand#23'                                        +
         AND p_container IN ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK')+
         AND l_quantity >= 10                                            +
         AND l_quantity <= 10 + 10                                       +
         AND p_size BETWEEN 1 AND 10                                     +
         AND l_shipmode IN ('AIR', 'AIR REG')                            +
         AND l_shipinstruct = 'DELIVER IN PERSON')                       +
     OR (p_partkey = l_partkey                                           +
         AND p_brand = 'Brand#34'                                        +
         AND p_container IN ('LG CASE', 'LG BOX', 'LG PACK', 'LG PKG')   +
         AND l_quantity >= 20                                            +
         AND l_quantity <= 20 + 10                                       +
         AND p_size BETWEEN 1 AND 15                                     +
         AND l_shipmode IN ('AIR', 'AIR REG')                            +
         AND l_shipinstruct = 'DELIVER IN PERSON');                      +
 
(1 row)

select query as query20 from tpch_queries(20); \gset
                                query20                                
-----------------------------------------------------------------------
 SELECT                                                               +
     s_name,                                                          +
     s_address                                                        +
 FROM                                                                 +
     supplier,                                                        +
     nation                                                           +
 WHERE                                                                +
     s_suppkey IN (                                                   +
         SELECT                                                       +
             ps_suppkey                                               +
         FROM                                                         +
             partsupp                                                 +
         WHERE                                                        +
             ps_partkey IN (                                          +
                 SELECT                                               +
                     p_partkey                                        +
                 FROM                                                 +
                     part                                             +
                 WHERE                                                +
                     p_name LIKE 'forest%')                           +
                 AND ps_availqty > (                                  +
                     SELECT                                           +
                         0.5 * sum(l_quantity)                        +
                     FROM                                             +
                         lineitem                                     +
                     WHERE                                            +
                         l_partkey = ps_partkey                       +
                         AND l_suppkey = ps_suppkey                   +
                         AND l_shipdate >= CAST('1994-01-01' AS date) +
                         AND l_shipdate < CAST('1995-01-01' AS date)))+
             AND s_nationkey = n_nationkey                            +
             AND n_name = 'CANADA'                                    +
         ORDER BY                                                     +
             s_name;                                                  +
 
(1 row)

select query as query21 from tpch_queries(21); \gset
                       query21                       
-----------------------------------------------------
 SELECT                                             +
     s_name,                                        +
     count(*) AS numwait                            +
 FROM                                               +
     supplier,                                      +
     lineitem l1,                                   +
     orders,                                        +
     nation                                         +
 WHERE                                              +
     s_suppkey = l1.l_suppkey                       +
     AND o_orderkey = l1.l_orderkey                 +
     AND o_orderstatus = 'F'                        +
     AND l1.l_receiptdate > l1.l_commitdate         +
     AND EXISTS (                                   +
         SELECT                                     +
             *                                      +
         FROM                                       +
             lineitem l2                            +
         WHERE                                      +
             l2.l_orderkey = l1.l_orderkey          +
             AND l2.l_suppkey <> l1.l_suppkey)      +
     AND NOT EXISTS (                               +
         SELECT                                     +
             *                                      +
         FROM                                       +
             lineitem l3                            +
         WHERE                                      +
             l3.l_orderkey = l1.l_orderkey          +
             AND l3.l_suppkey <> l1.l_suppkey       +
             AND l3.l_receiptdate > l3.l_commitdate)+
     AND s_nationkey = n_nationkey                  +
     AND n_name = 'SAUDI ARABIA'                    +
 GROUP BY                                           +
     s_name                                         +
 ORDER BY                                           +
     numwait DESC,                                  +
     s_name                                         +
 LIMIT 100;                                         +
 
(1 row)

select query as query22 from tpch_queries(22); \gset
                                              query22                                               
----------------------------------------------------------------------------------------------------
 SELECT                                                                                            +
     cntrycode,                                                                                    +
     count(*) AS numcust,                                                                          +
     sum(c_acctbal) AS totacctbal                                                                  +
 FROM (                                                                                            +
     SELECT                                                                                        +
         substring(c_phone FROM 1 FOR 2) AS cntrycode,                                             +
         c_acctbal                                                                                 +
     FROM                                                                                          +
         customer                                                                                  +
     WHERE                                                                                         +
         substring(c_phone FROM 1 FOR 2) IN ('13', '31', '23', '29', '30', '18', '17')             +
         AND c_acctbal > (                                                                         +
             SELECT                                                                                +
                 avg(c_acctbal)                                                                    +
             FROM                                                                                  +
                 customer                                                                          +
             WHERE                                                                                 +
                 c_acctbal > 0.00                                                                  +
                 AND substring(c_phone FROM 1 FOR 2) IN ('13', '31', '23', '29', '30', '18', '17'))+
             AND NOT EXISTS (                                                                      +
                 SELECT                                                                            +
                     *                                                                             +
                 FROM                                                                              +
                     orders                                                                        +
                 WHERE                                                                             +
                     o_custkey = c_custkey)) AS custsale                                           +
 GROUP BY                                                                                          +
     cntrycode                                                                                     +
 ORDER BY                                                                                          +
     cntrycode;                                                                                    +
 
(1 row)

set pg_orca.enable_orca to on;
explain (costs off ) :query1;
                        QUERY PLAN                        
----------------------------------------------------------
 GroupAggregate
   Group Key: l_returnflag, l_linestatus
   ->  Sort
         Sort Key: l_returnflag, l_linestatus
         ->  Seq Scan on lineitem
               Filter: (l_shipdate <= '09-02-1998'::date)
 Optimizer: pg_orca
(7 rows)

explain (costs off ) :query2;
                                                                                 QUERY PLAN                                                                                  
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit
   ->  Nested Loop
         Join Filter: (nation.n_regionkey = region.r_regionkey)
         ->  Sort
               Sort Key: supplier.s_acctbal DESC, nation.n_name, supplier.s_name, part.p_partkey
               ->  Nested Loop
                     Join Filter: (supplier.s_nationkey = nation.n_nationkey)
                     ->  Nested Loop
                           Join Filter: ((part.p_partkey = partsupp.ps_partkey) AND (supplier.s_suppkey = partsupp.ps_suppkey) AND (partsupp.ps_supplycost = ((SubPlan 1))))
                           ->  Nested Loop
                                 Join Filter: true
                                 ->  Result
                                       ->  Seq Scan on part
                                             Filter: ((p_size = 15) AND ((p_type)::text ~~ '%BRASS'::text))
                                       SubPlan 1
                                         ->  Aggregate
                                               ->  Result
                                                     Filter: (part.p_partkey = partsupp_1.ps_partkey)
                                                     ->  Nested Loop
                                                           Join Filter: (nation_1.n_regionkey = region_1.r_regionkey)
                                                           ->  Nested Loop
                                                                 Join Filter: (supplier_1.s_nationkey = nation_1.n_nationkey)
                                                                 ->  Nested Loop
                                                                       Join Filter: (supplier_1.s_suppkey = partsupp_1.ps_suppkey)
                                                                       ->  Seq Scan on partsupp partsupp_1
                                                                       ->  Seq Scan on supplier supplier_1
                                                                 ->  Seq Scan on nation nation_1
                                                           ->  Seq Scan on region region_1
                                                                 Filter: (r_name = 'EUROPE'::bpchar)
                                 ->  Seq Scan on supplier
                           ->  Seq Scan on partsupp
                     ->  Seq Scan on nation
         ->  Seq Scan on region
               Filter: (r_name = 'EUROPE'::bpchar)
 Optimizer: pg_orca
(35 rows)

explain (costs off ) :query3;
                                                     QUERY PLAN                                                      
---------------------------------------------------------------------------------------------------------------------
 Limit
   ->  Sort
         Sort Key: (sum((lineitem.l_extendedprice * ((1)::numeric - lineitem.l_discount)))) DESC, orders.o_orderdate
         ->  GroupAggregate
               Group Key: orders.o_orderdate, lineitem.l_orderkey, orders.o_shippriority
               ->  Sort
                     Sort Key: orders.o_orderdate, lineitem.l_orderkey, orders.o_shippriority
                     ->  Nested Loop
                           Join Filter: (lineitem.l_orderkey = orders.o_orderkey)
                           ->  Nested Loop
                                 Join Filter: (customer.c_custkey = orders.o_custkey)
                                 ->  Seq Scan on customer
                                       Filter: (c_mktsegment = 'BUILDING'::bpchar)
                                 ->  Seq Scan on orders
                                       Filter: (o_orderdate < '03-15-1995'::date)
                           ->  Seq Scan on lineitem
                                 Filter: (l_shipdate > '03-15-1995'::date)
 Optimizer: pg_orca
(18 rows)

explain (costs off ) :query4;
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 GroupAggregate
   Group Key: orders.o_orderpriority
   ->  Sort
         Sort Key: orders.o_orderpriority
         ->  Seq Scan on orders
               Filter: (((o_orderdate >= '07-01-1993'::date) AND (o_orderdate < '10-01-1993'::date)) AND EXISTS(SubPlan 1))
               SubPlan 1
                 ->  Result
                       Filter: (lineitem.l_orderkey = orders.o_orderkey)
                       ->  Seq Scan on lineitem
                             Filter: (l_commitdate < l_receiptdate)
 Optimizer: pg_orca
(12 rows)

explain (costs off ) :query5;
                                                                 QUERY PLAN                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: (sum((lineitem.l_extendedprice * ((1)::numeric - lineitem.l_discount)))) DESC
   ->  GroupAggregate
         Group Key: nation.n_name
         ->  Nested Loop
               Join Filter: (nation.n_regionkey = region.r_regionkey)
               ->  Sort
                     Sort Key: nation.n_name
                     ->  Nested Loop
                           Join Filter: (supplier.s_nationkey = nation.n_nationkey)
                           ->  Nested Loop
                                 Join Filter: ((lineitem.l_suppkey = supplier.s_suppkey) AND (customer.c_nationkey = supplier.s_nationkey))
                                 ->  Nested Loop
                                       Join Filter: (lineitem.l_orderkey = orders.o_orderkey)
                                       ->  Nested Loop
                                             Join Filter: (customer.c_custkey = orders.o_custkey)
                                             ->  Seq Scan on customer
                                             ->  Seq Scan on orders
                                                   Filter: ((o_orderdate >= '01-01-1994'::date) AND (o_orderdate < '01-01-1995'::date))
                                       ->  Seq Scan on lineitem
                                 ->  Seq Scan on supplier
                           ->  Seq Scan on nation
               ->  Seq Scan on region
                     Filter: (r_name = 'ASIA'::bpchar)
 Optimizer: pg_orca
(25 rows)

explain (costs off ) :query6;
                                                                                  QUERY PLAN                                                                                   
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate
   ->  Seq Scan on lineitem
         Filter: ((l_shipdate >= '01-01-1994'::date) AND (l_shipdate < '01-01-1995'::date) AND (l_discount >= 0.05) AND (l_discount <= 0.07) AND (l_quantity < (24)::numeric))
 Optimizer: pg_orca
(4 rows)

explain (costs off ) :query7;
                                                                                                          QUERY PLAN                                                                                                           
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate
   Group Key: n1.n_name, n2.n_name, ("extract"('year'::text, lineitem.l_shipdate))
   ->  Sort
         Sort Key: n1.n_name, n2.n_name, ("extract"('year'::text, lineitem.l_shipdate))
         ->  Result
               ->  Nested Loop
                     Join Filter: ((customer.c_nationkey = n2.n_nationkey) AND (((n1.n_name = 'FRANCE'::bpchar) AND (n2.n_name = 'GERMANY'::bpchar)) OR ((n1.n_name = 'GERMANY'::bpchar) AND (n2.n_name = 'FRANCE'::bpchar))))
                     ->  Nested Loop
                           Join Filter: (supplier.s_nationkey = n1.n_nationkey)
                           ->  Nested Loop
                                 Join Filter: (customer.c_custkey = orders.o_custkey)
                                 ->  Nested Loop
                                       Join Filter: (orders.o_orderkey = lineitem.l_orderkey)
                                       ->  Nested Loop
                                             Join Filter: (supplier.s_suppkey = lineitem.l_suppkey)
                                             ->  Seq Scan on supplier
                                             ->  Seq Scan on lineitem
                                                   Filter: ((l_shipdate >= '01-01-1995'::date) AND (l_shipdate <= '12-31-1996'::date))
                                       ->  Seq Scan on orders
                                 ->  Seq Scan on customer
                           ->  Seq Scan on nation n1
                                 Filter: ((n_name = 'FRANCE'::bpchar) OR (n_name = 'GERMANY'::bpchar))
                     ->  Seq Scan on nation n2
                           Filter: ((n_name = 'GERMANY'::bpchar) OR (n_name = 'FRANCE'::bpchar))
 Optimizer: pg_orca
(25 rows)

explain (costs off ) :query8;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Result
   ->  GroupAggregate
         Group Key: ("extract"('year'::text, orders.o_orderdate))
         ->  Sort
               Sort Key: ("extract"('year'::text, orders.o_orderdate))
               ->  Result
                     ->  Nested Loop
                           Join Filter: (n1.n_regionkey = region.r_regionkey)
                           ->  Nested Loop
                                 Join Filter: (supplier.s_nationkey = n2.n_nationkey)
                                 ->  Nested Loop
                                       Join Filter: (customer.c_nationkey = n1.n_nationkey)
                                       ->  Nested Loop
                                             Join Filter: (orders.o_custkey = customer.c_custkey)
                                             ->  Nested Loop
                                                   Join Filter: (lineitem.l_orderkey = orders.o_orderkey)
                                                   ->  Nested Loop
                                                         Join Filter: ((part.p_partkey = lineitem.l_partkey) AND (supplier.s_suppkey = lineitem.l_suppkey))
                                                         ->  Nested Loop
                                                               Join Filter: true
                                                               ->  Seq Scan on part
                                                                     Filter: ((p_type)::text = 'ECONOMY ANODIZED STEEL'::text)
                                                               ->  Seq Scan on supplier
                                                         ->  Seq Scan on lineitem
                                                   ->  Seq Scan on orders
                                                         Filter: ((o_orderdate >= '01-01-1995'::date) AND (o_orderdate <= '12-31-1996'::date))
                                             ->  Seq Scan on customer
                                       ->  Seq Scan on nation n1
                                 ->  Seq Scan on nation n2
                           ->  Seq Scan on region
                                 Filter: (r_name = 'AMERICA'::bpchar)
 Optimizer: pg_orca
(32 rows)

explain (costs off ) :query9;
                                                                QUERY PLAN                                                                
------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate
   Group Key: nation.n_name, ("extract"('year'::text, orders.o_orderdate))
   ->  Sort
         Sort Key: nation.n_name, ("extract"('year'::text, orders.o_orderdate)) DESC
         ->  Result
               ->  Nested Loop
                     Join Filter: (supplier.s_nationkey = nation.n_nationkey)
                     ->  Nested Loop
                           Join Filter: (orders.o_orderkey = lineitem.l_orderkey)
                           ->  Nested Loop
                                 Join Filter: ((partsupp.ps_suppkey = lineitem.l_suppkey) AND (partsupp.ps_partkey = lineitem.l_partkey))
                                 ->  Nested Loop
                                       Join Filter: ((supplier.s_suppkey = lineitem.l_suppkey) AND (part.p_partkey = lineitem.l_partkey))
                                       ->  Nested Loop
                                             Join Filter: true
                                             ->  Seq Scan on part
                                                   Filter: ((p_name)::text ~~ '%green%'::text)
                                             ->  Seq Scan on supplier
                                       ->  Seq Scan on lineitem
                                 ->  Seq Scan on partsupp
                           ->  Seq Scan on orders
                     ->  Seq Scan on nation
 Optimizer: pg_orca
(23 rows)

explain (costs off ) :query10;
                                                                           QUERY PLAN                                                                           
----------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit
   ->  Sort
         Sort Key: (sum((lineitem.l_extendedprice * ((1)::numeric - lineitem.l_discount)))) DESC
         ->  GroupAggregate
               Group Key: customer.c_custkey, customer.c_name, customer.c_acctbal, customer.c_phone, nation.n_name, customer.c_address, customer.c_comment
               ->  Sort
                     Sort Key: customer.c_custkey, customer.c_name, customer.c_acctbal, customer.c_phone, nation.n_name, customer.c_address, customer.c_comment
                     ->  Nested Loop
                           Join Filter: (customer.c_nationkey = nation.n_nationkey)
                           ->  Nested Loop
                                 Join Filter: (lineitem.l_orderkey = orders.o_orderkey)
                                 ->  Nested Loop
                                       Join Filter: (customer.c_custkey = orders.o_custkey)
                                       ->  Seq Scan on customer
                                       ->  Seq Scan on orders
                                             Filter: ((o_orderdate >= '10-01-1993'::date) AND (o_orderdate < '01-01-1994'::date))
                                 ->  Seq Scan on lineitem
                                       Filter: (l_returnflag = 'R'::bpchar)
                           ->  Seq Scan on nation
 Optimizer: pg_orca
(20 rows)

explain (costs off ) :query11;
                                               QUERY PLAN                                                
---------------------------------------------------------------------------------------------------------
 Result
   ->  Sort
         Sort Key: (sum((partsupp.ps_supplycost * (partsupp.ps_availqty)::numeric))) DESC
         ->  Result
               Filter: ((sum((partsupp.ps_supplycost * (partsupp.ps_availqty)::numeric))) > (SubPlan 1))
               ->  GroupAggregate
                     Group Key: partsupp.ps_partkey
                     ->  Sort
                           Sort Key: partsupp.ps_partkey
                           ->  Nested Loop
                                 Join Filter: (supplier.s_nationkey = nation.n_nationkey)
                                 ->  Nested Loop
                                       Join Filter: (partsupp.ps_suppkey = supplier.s_suppkey)
                                       ->  Seq Scan on partsupp
                                       ->  Seq Scan on supplier
                                 ->  Seq Scan on nation
                                       Filter: (n_name = 'GERMANY'::bpchar)
               SubPlan 1
                 ->  Result
                       ->  Aggregate
                             ->  Nested Loop
                                   Join Filter: (supplier_1.s_nationkey = nation_1.n_nationkey)
                                   ->  Nested Loop
                                         Join Filter: (partsupp_1.ps_suppkey = supplier_1.s_suppkey)
                                         ->  Seq Scan on partsupp partsupp_1
                                         ->  Seq Scan on supplier supplier_1
                                   ->  Seq Scan on nation nation_1
                                         Filter: (n_name = 'GERMANY'::bpchar)
 Optimizer: pg_orca
(29 rows)

explain (costs off ) :query12;
                                                                                                            QUERY PLAN                                                                                                            
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate
   Group Key: lineitem.l_shipmode
   ->  Sort
         Sort Key: lineitem.l_shipmode
         ->  Nested Loop
               Join Filter: (orders.o_orderkey = lineitem.l_orderkey)
               ->  Seq Scan on orders
               ->  Seq Scan on lineitem
                     Filter: ((l_shipmode = ANY ('{MAIL,SHIP}'::bpchar[])) AND (l_commitdate < l_receiptdate) AND (l_shipdate < l_commitdate) AND (l_receiptdate >= '01-01-1994'::date) AND (l_receiptdate < '01-01-1995'::date))
 Optimizer: pg_orca
(10 rows)

explain (costs off ) :query13;
                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Sort
   Sort Key: (count()) DESC, (count(orders.o_orderkey)) DESC
   ->  GroupAggregate
         Group Key: (count(orders.o_orderkey))
         ->  Sort
               Sort Key: (count(orders.o_orderkey))
               ->  GroupAggregate
                     Group Key: customer.c_custkey
                     ->  Sort
                           Sort Key: customer.c_custkey
                           ->  Nested Loop Left Join
                                 Join Filter: (customer.c_custkey = orders.o_custkey)
                                 ->  Seq Scan on customer
                                 ->  Seq Scan on orders
                                       Filter: ((o_comment)::text !~~ '%special%requests%'::text)
 Optimizer: pg_orca
(16 rows)

explain (costs off ) :query14;
                                               QUERY PLAN                                               
--------------------------------------------------------------------------------------------------------
 Result
   ->  Aggregate
         ->  Nested Loop
               Join Filter: (lineitem.l_partkey = part.p_partkey)
               ->  Seq Scan on lineitem
                     Filter: ((l_shipdate >= '09-01-1995'::date) AND (l_shipdate < '10-01-1995'::date))
               ->  Seq Scan on part
 Optimizer: pg_orca
(8 rows)

explain (costs off ) :query15;
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: supplier.s_suppkey
   ->  Nested Loop
         Join Filter: (supplier.s_suppkey = lineitem.l_suppkey)
         ->  Seq Scan on supplier
         ->  Result
               Filter: ((sum((lineitem.l_extendedprice * ((1)::numeric - lineitem.l_discount)))) = (SubPlan 1))
               ->  GroupAggregate
                     Group Key: lineitem.l_suppkey
                     ->  Sort
                           Sort Key: lineitem.l_suppkey
                           ->  Seq Scan on lineitem
                                 Filter: ((l_shipdate >= '01-01-1996'::date) AND (l_shipdate < '04-01-1996'::date))
               SubPlan 1
                 ->  Aggregate
                       ->  GroupAggregate
                             Group Key: lineitem_1.l_suppkey
                             ->  Sort
                                   Sort Key: lineitem_1.l_suppkey
                                   ->  Seq Scan on lineitem lineitem_1
                                         Filter: ((l_shipdate >= '01-01-1996'::date) AND (l_shipdate < '04-01-1996'::date))
 Optimizer: pg_orca
(22 rows)

explain (costs off ) :query16;
                                                                                                                                                                                                                               QUERY PLAN                                                                                                                                                                                                                               
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: (count(partsupp.ps_suppkey)) DESC, part.p_brand, part.p_type, part.p_size
   ->  GroupAggregate
         Group Key: part.p_brand, part.p_type, part.p_size
         ->  Sort
               Sort Key: part.p_brand, part.p_type, part.p_size
               ->  Nested Loop
                     Join Filter: (part.p_partkey = partsupp.ps_partkey)
                     ->  Seq Scan on partsupp
                           Filter: (SubPlan 1)
                           SubPlan 1
                             ->  Result
                                   ->  Result
                                         Filter: ((CASE WHEN ((sum((CASE WHEN (partsupp.ps_suppkey = supplier.s_suppkey) THEN 1 ELSE 0 END))) IS NULL) THEN true WHEN ((sum((CASE WHEN (supplier.s_suppkey IS NULL) THEN 1 ELSE 0 END))) > '0'::bigint) THEN NULL::boolean WHEN (partsupp.ps_suppkey IS NULL) THEN NULL::boolean WHEN ((sum((CASE WHEN (partsupp.ps_suppkey = supplier.s_suppkey) THEN 1 ELSE 0 END))) = '0'::bigint) THEN true ELSE false END) = true)
                                         ->  Result
                                               ->  Aggregate
                                                     ->  Result
                                                           ->  Seq Scan on supplier
                                                                 Filter: ((s_comment)::text ~~ '%Customer%Complaints%'::text)
                     ->  Seq Scan on part
                           Filter: ((p_brand <> 'Brand#45'::bpchar) AND ((p_type)::text !~~ 'MEDIUM POLISHED%'::text) AND (p_size = ANY ('{49,14,23,45,19,3,36,9}'::integer[])))
 Optimizer: pg_orca
(22 rows)

explain (costs off ) :query17;
                                                    QUERY PLAN                                                    
------------------------------------------------------------------------------------------------------------------
 Result
   ->  Aggregate
         ->  Nested Loop
               Join Filter: ((part.p_partkey = lineitem_1.l_partkey) AND (lineitem_1.l_quantity < ((SubPlan 1))))
               ->  Seq Scan on lineitem lineitem_1
               ->  Result
                     ->  Seq Scan on part
                           Filter: ((p_brand = 'Brand#23'::bpchar) AND (p_container = 'MED BOX'::bpchar))
                     SubPlan 1
                       ->  Result
                             ->  Aggregate
                                   ->  Seq Scan on lineitem
                                         Filter: (l_partkey = part.p_partkey)
 Optimizer: pg_orca
(14 rows)

explain (costs off ) :query18;
                                                          QUERY PLAN                                                          
------------------------------------------------------------------------------------------------------------------------------
 Limit
   ->  GroupAggregate
         Group Key: orders.o_totalprice, orders.o_orderdate, customer.c_name, customer.c_custkey, orders.o_orderkey
         ->  Sort
               Sort Key: orders.o_totalprice DESC, orders.o_orderdate, customer.c_name, customer.c_custkey, orders.o_orderkey
               ->  Nested Loop
                     Join Filter: (orders.o_orderkey = lineitem.l_orderkey)
                     ->  Nested Loop
                           Join Filter: (customer.c_custkey = orders.o_custkey)
                           ->  Seq Scan on customer
                           ->  Seq Scan on orders
                                 Filter: (ANY (o_orderkey = (SubPlan 1).col1))
                                 SubPlan 1
                                   ->  Result
                                         Filter: ((sum(lineitem_1.l_quantity)) > (300)::numeric)
                                         ->  GroupAggregate
                                               Group Key: lineitem_1.l_orderkey
                                               ->  Sort
                                                     Sort Key: lineitem_1.l_orderkey
                                                     ->  Seq Scan on lineitem lineitem_1
                     ->  Seq Scan on lineitem
 Optimizer: pg_orca
(22 rows)

explain (costs off ) :query19;
                                                                                                                                                                                                                                                                                                                                                                                                     QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                     
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate
   ->  Nested Loop
         Join Filter: ((part.p_partkey = lineitem.l_partkey) AND (((part.p_brand = 'Brand#12'::bpchar) AND (part.p_container = ANY ('{"SM CASE","SM BOX","SM PACK","SM PKG"}'::bpchar[])) AND (lineitem.l_quantity >= (1)::numeric) AND (lineitem.l_quantity <= ((1 + 10))::numeric) AND (part.p_size <= 5)) OR ((part.p_brand = 'Brand#23'::bpchar) AND (part.p_container = ANY ('{"MED BAG","MED BOX","MED PKG","MED PACK"}'::bpchar[])) AND (lineitem.l_quantity >= (10)::numeric) AND (lineitem.l_quantity <= ((10 + 10))::numeric) AND (part.p_size <= 10)) OR ((part.p_brand = 'Brand#34'::bpchar) AND (part.p_container = ANY ('{"LG CASE","LG BOX","LG PACK","LG PKG"}'::bpchar[])) AND (lineitem.l_quantity >= (20)::numeric) AND (lineitem.l_quantity <= ((20 + 10))::numeric) AND (part.p_size <= 15))))
         ->  Seq Scan on lineitem
               Filter: ((l_shipmode = ANY ('{AIR,"AIR REG"}'::bpchar[])) AND (l_shipinstruct = 'DELIVER IN PERSON'::bpchar) AND (((l_quantity >= (1)::numeric) AND (l_quantity <= ((1 + 10))::numeric)) OR ((l_quantity >= (10)::numeric) AND (l_quantity <= ((10 + 10))::numeric)) OR ((l_quantity >= (20)::numeric) AND (l_quantity <= ((20 + 10))::numeric))))
         ->  Seq Scan on part
               Filter: ((p_size >= 1) AND (((p_brand = 'Brand#12'::bpchar) AND (p_container = ANY ('{"SM CASE","SM BOX","SM PACK","SM PKG"}'::bpchar[])) AND (p_size <= 5)) OR ((p_brand = 'Brand#23'::bpchar) AND (p_container = ANY ('{"MED BAG","MED BOX","MED PKG","MED PACK"}'::bpchar[])) AND (p_size <= 10)) OR ((p_brand = 'Brand#34'::bpchar) AND (p_container = ANY ('{"LG CASE","LG BOX","LG PACK","LG PKG"}'::bpchar[])) AND (p_size <= 15))))
 Optimizer: pg_orca
(8 rows)

explain (costs off ) :query20;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: supplier.s_name
   ->  Nested Loop Semi Join
         Join Filter: (supplier.s_suppkey = partsupp.ps_suppkey)
         ->  Nested Loop
               Join Filter: (supplier.s_nationkey = nation.n_nationkey)
               ->  Seq Scan on supplier
               ->  Seq Scan on nation
                     Filter: (n_name = 'CANADA'::bpchar)
         ->  Result
               Filter: ((partsupp.ps_availqty)::numeric > (SubPlan 1))
               ->  Nested Loop Semi Join
                     Join Filter: (partsupp.ps_partkey = part.p_partkey)
                     ->  Seq Scan on partsupp
                     ->  Seq Scan on part
                           Filter: ((p_name)::text ~~ 'forest%'::text)
               SubPlan 1
                 ->  Result
                       ->  Aggregate
                             ->  Result
                                   Filter: ((lineitem.l_partkey = partsupp.ps_partkey) AND (lineitem.l_suppkey = partsupp.ps_suppkey))
                                   ->  Seq Scan on lineitem
                                         Filter: ((l_shipdate >= '01-01-1994'::date) AND (l_shipdate < '01-01-1995'::date))
 Optimizer: pg_orca
(24 rows)

explain (costs off ) :query21;
                                                             QUERY PLAN                                                              
-------------------------------------------------------------------------------------------------------------------------------------
 Limit
   ->  Sort
         Sort Key: (count()) DESC, supplier.s_name
         ->  GroupAggregate
               Group Key: supplier.s_name
               ->  Nested Loop
                     Join Filter: (supplier.s_nationkey = nation.n_nationkey)
                     ->  Sort
                           Sort Key: supplier.s_name
                           ->  Nested Loop
                                 Join Filter: (orders.o_orderkey = l1.l_orderkey)
                                 ->  Nested Loop
                                       Join Filter: (supplier.s_suppkey = l1.l_suppkey)
                                       ->  Seq Scan on supplier
                                       ->  Nested Loop Anti Join
                                             Join Filter: ((l3.l_orderkey = l1.l_orderkey) AND (l3.l_suppkey <> l1.l_suppkey))
                                             ->  Nested Loop Semi Join
                                                   Join Filter: ((l2.l_orderkey = l1.l_orderkey) AND (l2.l_suppkey <> l1.l_suppkey))
                                                   ->  Seq Scan on lineitem l1
                                                         Filter: (l_receiptdate > l_commitdate)
                                                   ->  Seq Scan on lineitem l2
                                             ->  Seq Scan on lineitem l3
                                                   Filter: (l_receiptdate > l_commitdate)
                                 ->  Seq Scan on orders
                                       Filter: (o_orderstatus = 'F'::bpchar)
                     ->  Seq Scan on nation
                           Filter: (n_name = 'SAUDI ARABIA'::bpchar)
 Optimizer: pg_orca
(28 rows)

explain (costs off ) :query22;
                                                                   QUERY PLAN                                                                   
------------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate
   Group Key: ("substring"((customer_1.c_phone)::text, 1, 2))
   ->  Sort
         Sort Key: ("substring"((customer_1.c_phone)::text, 1, 2))
         ->  Result
               ->  Nested Loop
                     Join Filter: (customer_1.c_acctbal > (avg(customer.c_acctbal)))
                     ->  Nested Loop Anti Join
                           Join Filter: (orders.o_custkey = customer_1.c_custkey)
                           ->  Seq Scan on customer customer_1
                                 Filter: ("substring"((c_phone)::text, 1, 2) = ANY ('{13,31,23,29,30,18,17}'::text[]))
                           ->  Seq Scan on orders
                     ->  Aggregate
                           ->  Seq Scan on customer
                                 Filter: ((c_acctbal > 0.00) AND ("substring"((c_phone)::text, 1, 2) = ANY ('{13,31,23,29,30,18,17}'::text[])))
 Optimizer: pg_orca
(16 rows)

